# Create Challenge Wizard Implementation Plan

This plan outlines the steps to implement the new "Create Challenge" wizard in the WebApp, ensuring consistency with the React Native App as per PRD-WEB-05A.

## 1. Preparation & Data Fetching
- **Goal**: Ensure the wizard has access to necessary data (User's Groups).
- **Files**: `apps/web/src/app/(protected)/app/challenges/new/page.tsx`
- **Action**:
    - Update the Server Component to fetch the authenticated user's groups using `supabase` client.
    - Pass the list of groups as props to the Client Component.

## 2. Component Architecture (React Pattern)
- **Goal**: Create a maintainable, multi-step wizard using Composition and Controlled Components.
- **New Component**: `CreateChallengeWizard` (Client Component).
    - **State**: `step` (current step), `formData` (accumulated data).
    - **Structure**:
        - **Step 1: Type Selection** (`StepType`)
            - Cards for Reading, Meditation, Fasting, Communion.
        - **Step 2: Details** (`StepDetails`)
            - Title Input.
            - Duration Preset Selector (3, 7, 14, 21 days).
        - **Step 3: Group Selection** (`StepGroup`)
            - Select component filtering the user's groups.
        - **Step 4: Confirmation** (`StepConfirm`)
            - Read-only summary and "Create" action.
- **Shared Components**:
    - `DurationPresetSelector`: Reusable component for duration chips.
    - `GroupSelect`: Reusable select component.

## 3. Implementation Details
- **Tech Stack**: React (Client Components), Tailwind CSS, Lucide Icons, Supabase Client.
- **Validation**:
    - Prevent advancing if required fields are empty.
    - Restrict duration to presets.
    - Require Group selection.
- **Business Logic**:
    - `start_date` defaults to `new Date()`.
    - `end_date` calculated based on duration.
    - `unlock_policy` removed (defaults to `daily` in schema).
    - Transactional creation (Challenge + Participant) handled via Supabase calls (or `rpc` if available, otherwise sequential).

## 4. Execution Steps
1.  **Refactor Page**: Modify `page.tsx` to fetch groups and render the new Wizard instead of the old form.
2.  **Create Wizard Component**: Implement `CreateChallengeWizard` in `components/challenges/create-challenge-wizard.tsx`.
3.  **Implement Steps**: Build `StepType`, `StepDetails`, `StepGroup`, `StepConfirm` as internal or separate components.
4.  **Integrate Logic**: Move the creation logic (Supabase insert) to the `StepConfirm` phase.
5.  **Cleanup**: Delete or deprecate `create-challenge-form.tsx` if no longer used.

## 5. Verification
- Verify flow: Type -> Details -> Group -> Confirm.
- Verify validation: Cannot skip steps.
- Verify data: Challenge created with correct fields, Participant created.
