# Implementation Plan: Web App Onboarding Flow

We will implement a mandatory onboarding wizard for users who haven't completed their setup (`onboarding_completed=false`). This ensures users have a name, church, and interests defined before accessing the main app.

## 1. Components Implementation
We will create a dedicated onboarding feature structure in `src/components/onboarding`.

### 1.1 Wizard Wrapper (`wizard.tsx`)
- Manages current step state (1 to 3).
- Handles navigation between steps.
- Shows progress indicator.

### 1.2 Step 1: Profile (`steps/profile-step.tsx`)
- Input for **Name** (required, min 2 chars).
- Input for **Photo URL** (optional).
- Updates `public.users` via Supabase.

### 1.3 Step 2: Church (`steps/church-step.tsx`)
- Reuses existing `ChurchPicker` component.
- Displays selected church or "Select Church" button.
- Allows skipping ("Pular por enquanto").

### 1.4 Step 3: Interests (`steps/interests-step.tsx`)
- Multi-select interface for interests (e.g., "Louvor", "Grupos", "Estudos").
- Updates `interests` array in `public.users`.
- Final "Concluir" action sets `onboarding_completed=true`.

## 2. Page & Routing
### 2.1 Onboarding Page
- Create `apps/web/src/app/(protected)/app/onboarding/page.tsx`.
- Renders the `Wizard` component.

### 2.2 Global Gate (Layout)
- Modify `apps/web/src/app/(protected)/layout.tsx`.
- Fetch user profile server-side.
- Use a new `OnboardingGuard` client component to handle redirects:
  - If `!completed` and not on onboarding page → Redirect to `/app/onboarding`.
  - If `completed` and on onboarding page → Redirect to `/app`.
- Conditionally render `AppShell` (Sidebar/Header) only for completed users.

## 3. Implementation Steps
1.  Create `apps/web/src/components/onboarding/` directory and step components.
2.  Create the `Wizard` container logic.
3.  Create the `/app/onboarding` page.
4.  Implement `OnboardingGuard` and update `layout.tsx` to enforce the flow.
5.  Verify the flow with manual testing (if possible) or code review.
